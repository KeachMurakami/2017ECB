AlltoPSII = PSII / (1.5 * PSI + PSII)
) %>%
replace_na(list(AlltoPSII = 0)) %>%
data.table
EEDs %>%
ggplot(aes(x = wavelength, y = AlltoPSII)) +
theme_bw2() +
gg_xy(c(380, 770, -0.05, 1.05)) +
# geom_ribbon(aes(ymin = AlltoPSII_max, ymax = AlltoPSII_min), col = "grey50") +
geom_line() +
xlab("Wavelength [nm]") + ylab("")
Mole_abs %>%
transmute(
wavelength,
AlltoPSII = PSII / (1.5 * PSI + PSII)
) %>%
replace_na(list(AlltoPSII = 0)) %>%
ggplot(aes(x = wavelength, y = AlltoPSII)) +
theme_bw2() +
gg_xy(c(380, 770, -0.05, 1.05)) +
# geom_ribbon(aes(ymin = AlltoPSII_max, ymax = AlltoPSII_min), col = "grey50") +
geom_line() +
xlab("Wavelength [nm]") + ylab("")
library(EBImage)
which_mean <- function(x) x %>% which %>% mean
Join_by <- function(x, y) join(x, y, by = "wavelength")
Hoge_PSII <- readImage("~/Dropbox/Publish/2016PgEstimate/Data/Hoge_PSII.png")
Hoge_PSI <- readImage("~/Dropbox/Publish/2016PgEstimate/Data/Hoge_PSI.png")
Abs_PSII <-
(Hoge_PSII[, , 1] < .8 & Hoge_PSII[, , 3] > .8) %>%
.@.Data %>%
data.frame %>%
t %>%
aaply(.margins = 2, .fun = which_mean) %>%
data.frame(wavelength = seq(400, 800, by = 1), abs = (dim(Hoge_PSII)[2] - .)) %>%
select(wavelength, PSII = abs)
Abs_PSI <-
(Hoge_PSI[, , 1] > .8 & Hoge_PSI[, , 3] < .8) %>%
.@.Data %>%
data.frame %>%
t %>%
aaply(.margins = 2, .fun = which_mean) %>%
data.frame(wavelength = seq(400, 800, by = 1), abs = (dim(Hoge_PSI)[2] - .)) %>%
select(wavelength, PSI = abs)
Mole_abs <-
Reduce(Join_by, list(Abs_PSII, Abs_PSI)) %>%
filter(wavelength %% 1 == 0)
Abs_ratio <-
function(cut_row, simulate){
simulate_dat <-
simulate %>% slice(cut_row)
Infos <-
data.frame(`L_RCII` = simulate_dat$L_trimer_per_RCII,
`L2_L1L2` = simulate_dat$L_trimer_to_PSII,
`RCI_RCII` = simulate_dat$RCI_per_RCII)
Mole_abs %>%
transmute(
wavelength,
# AlltoPSII = ((PSII + Infos[1, 1] * Infos[1, 2] * LHCII) / (Infos[1, 3] * PSI + PSII + Infos[1, 1] * LHCII))
AlltoPSII = PSII / (PSII + Infos[1,3] * PSI)
) %>%
list(data = ., Info = Infos) %>%
return
}
EEDs <-
Mole_abs %>%
transmute(
wavelength,
AlltoPSII = PSII / (1.5 * PSI + PSII)
) %>%
replace_na(list(AlltoPSII = 0)) %>%
ggplot(aes(x = wavelength, y = AlltoPSII)) +
theme_bw2() +
gg_xy(c(380, 770, -0.05, 1.05)) +
# geom_ribbon(aes(ymin = AlltoPSII_max, ymax = AlltoPSII_min), col = "grey50") +
geom_line() +
xlab("Wavelength [nm]") + ylab("")
EEDs
Mole_abs %>%
transmute(
wavelength,
AlltoPSII = PSII / (1.5 * PSI + PSII)
) %>%
filter(AlltoPSII > 0) %>%
replace_na(list(AlltoPSII = 0)) %>%
ggplot(aes(x = wavelength, y = AlltoPSII)) +
theme_bw2() +
gg_xy(c(380, 770, -0.05, 1.05)) +
# geom_ribbon(aes(ymin = AlltoPSII_max, ymax = AlltoPSII_min), col = "grey50") +
geom_line() +
xlab("Wavelength [nm]") + ylab("")
```
Mole_abs %>%
transmute(
wavelength,
AlltoPSII = PSII / (1.5 * PSI + PSII)
) %>%
filter(AlltoPSII >= 0)  %>%
replace_na(list(AlltoPSII = 0)) %>%
ggplot(aes(x = wavelength, y = AlltoPSII)) +
theme_bw2() +
gg_xy(c(380, 770, -0.05, 1.05)) +
# geom_ribbon(aes(ymin = AlltoPSII_max, ymax = AlltoPSII_min), col = "grey50") +
geom_line() +
xlab("Wavelength [nm]") + ylab("")
WriteLog
WriteLog <- function(PubName = ""){
if(PubName == "") stop()
fread("~/Dropbox/R/my.data/MyWrite.csv") %>%
gather(Pub, words, -Date) %>%
na.omit %>%
mutate(Date = mdy(Date)) %>%
filter(Pub %in% PubName) %>%
ggplot(aes(Date, words, group = Pub, col = Pub)) +
theme_bw() +
theme(legend.position = c(.8, .4),
legend.key = element_blank(),
legend.title = element_blank(),
legend.background = element_blank()) +
geom_line() +
geom_point() +
ylab("Words in the body")
}
WriteLog()
WriteLog("ECB")
WriteLog("ECB") + gg_y(c(0, 3500))
Mole_abs %>%
transmute(
wavelength,
AlltoPSII = PSII / (1.5 * PSI + PSII)
) %>%
filter(AlltoPSII >= 0)  %>%
replace_na(list(AlltoPSII = 0)) %>%
ggplot(aes(x = wavelength, y = AlltoPSII)) +
theme_bw2() +
theme(panel.grid.major = element_blank()) +
gg_xy(c(380, 770, -0.05, 1.05)) +
# geom_ribbon(aes(ymin = AlltoPSII_max, ymax = AlltoPSII_min), col = "grey50") +
geom_line() +
xlab("Wavelength [nm]") + ylab("")
Mole_abs %>%
transmute(
wavelength,
AlltoPSII = PSII / (1.5 * PSI + PSII)
) %>%
filter(AlltoPSII >= 0)  %>%
replace_na(list(AlltoPSII = 0)) %>%
ggplot(aes(x = wavelength, y = AlltoPSII)) +
theme_bw2() +
theme(panel.grid.major = element_blank()) +
geom_hline(yintercept = 0.5) +
gg_xy(c(380, 770, -0.05, 1.05)) +
# geom_ribbon(aes(ymin = AlltoPSII_max, ymax = AlltoPSII_min), col = "grey50") +
geom_line() +
xlab("Wavelength [nm]") + ylab("")
Mole_abs %>%
transmute(
wavelength,
AlltoPSII = PSII / (1.5 * PSI + PSII)
) %>%
filter(AlltoPSII >= 0)  %>%
replace_na(list(AlltoPSII = 0)) %>%
ggplot(aes(x = wavelength, y = AlltoPSII)) +
theme_bw2() +
theme(panel.grid.major = element_blank()) +
geom_hline(yintercept = 0.5, col = "grey50") +
gg_xy(c(380, 770, -0.05, 1.05)) +
# geom_ribbon(aes(ymin = AlltoPSII_max, ymax = AlltoPSII_min), col = "grey50") +
geom_line() +
xlab("Wavelength [nm]") + ylab("")
Mole_abs %>%
transmute(
wavelength,
AlltoPSII = PSII / (1.5 * PSI + PSII)
) %>%
filter(AlltoPSII >= 0)  %>%
replace_na(list(AlltoPSII = 0)) %>%
ggplot(aes(x = wavelength, y = AlltoPSII)) +
theme_bw2() +
theme(panel.grid.major = element_blank()) +
geom_hline(yintercept = 0.5, col = "grey50", linetype = 3) +
gg_xy(c(380, 770, -0.05, 1.05)) +
# geom_ribbon(aes(ymin = AlltoPSII_max, ymax = AlltoPSII_min), col = "grey50") +
geom_line() +
xlab("Wavelength [nm]") + ylab("")
Mole_abs %>%
transmute(
wavelength,
AlltoPSII = PSII / (1.5 * PSI + PSII)
) %>%
filter(AlltoPSII >= 0)  %>%
replace_na(list(AlltoPSII = 0)) %>%
ggplot(aes(x = wavelength, y = AlltoPSII)) +
theme_bw2() +
theme(panel.grid.major = element_blank()) +
geom_hline(yintercept = 0.5, col = "grey50", linetype = 3) +
gg_xy(c(380, 770, -0.05, 1.05)) +
# geom_ribbon(aes(ymin = AlltoPSII_max, ymax = AlltoPSII_min), col = "grey50") +
geom_line() +
xlab("Wavelength [nm]") + ylab("Fraction of the excitation energy distributed to PSII")
Mole_abs %>%
transmute(
wavelength,
AlltoPSII = PSII / (1.5 * PSI + PSII)
) %>%
filter(AlltoPSII >= 0)  %>%
replace_na(list(AlltoPSII = 0)) %>%
ggplot(aes(x = wavelength, y = AlltoPSII)) +
theme_bw2() +
theme(panel.grid.major = element_blank()) +
geom_hline(yintercept = 0.5, col = "grey50", linetype = 3) +
gg_xy(c(380, 720, -0.05, 1.05)) +
# geom_ribbon(aes(ymin = AlltoPSII_max, ymax = AlltoPSII_min), col = "grey50") +
geom_line() +
xlab("Wavelength [nm]") + ylab("Fraction of the excitation energy distributed to PSII")
Mole_abs %>%
transmute(
wavelength,
AlltoPSII = PSII / (1.5 * PSI + PSII)
) %>%
filter(AlltoPSII >= 0)  %>%
replace_na(list(AlltoPSII = 0)) %>%
ggplot(aes(x = wavelength, y = AlltoPSII)) +
theme_bw2() +
theme(panel.grid.major = element_blank()) +
geom_hline(yintercept = 0.5, col = "grey50", linetype = 3) +
gg_xy(c(380, 820, -0.05, 1.05)) +
# geom_ribbon(aes(ymin = AlltoPSII_max, ymax = AlltoPSII_min), col = "grey50") +
geom_line() +
xlab("Wavelength [nm]") + ylab("Fraction of the excitation energy distributed to PSII")
Mole_abs %>%
transmute(
wavelength,
AlltoPSII = PSII / (1.5 * PSI + PSII)
) %>%
filter(AlltoPSII >= 0)  %>%
replace_na(list(AlltoPSII = 0)) %>%
ggplot(aes(x = wavelength, y = AlltoPSII)) +
theme_bw2() +
theme(panel.grid.major = element_blank()) +
geom_hline(yintercept = 0.5, col = "grey50", linetype = 3) +
gg_xy(c(380, 770, -0.05, 1.05)) +
# geom_ribbon(aes(ymin = AlltoPSII_max, ymax = AlltoPSII_min), col = "grey50") +
geom_line() +
xlab("Wavelength [nm]") + ylab("Fraction of the excitation energy distributed to PSII")
Mole_abs %>%
transmute(
wavelength,
AlltoPSII = PSII / (1.5 * PSI + PSII)
) %>%
filter(AlltoPSII >= 0)  %>%
replace_na(list(AlltoPSII = 0)) %>%
ggplot(aes(x = wavelength, y = AlltoPSII)) +
theme_bw2() +
theme(panel.grid.major = element_blank()) +
geom_hline(yintercept = 0.5, col = "grey50", linetype = 3) +
gg_xy(c(380, 770, 0, 1.0)) +
# geom_ribbon(aes(ymin = AlltoPSII_max, ymax = AlltoPSII_min), col = "grey50") +
geom_line() +
xlab("Wavelength [nm]") + ylab("Fraction of the excitation energy distributed to PSII")
Mole_abs %>%
transmute(
wavelength,
AlltoPSII = PSII / (1.5 * PSI + PSII)
) %>%
filter(AlltoPSII >= 0)  %>%
replace_na(list(AlltoPSII = 0)) %>%
ggplot(aes(x = wavelength, y = AlltoPSII)) +
theme_bw2() +
theme(panel.grid.major = element_blank()) +
geom_hline(yintercept = 0.5, col = "grey50", linetype = 3) +
gg_xy(c(380, 770, 0, 1.0)) +
# geom_ribbon(aes(ymin = AlltoPSII_max, ymax = AlltoPSII_min), col = "grey50") +
geom_line() +
geom_smooth() +
xlab("Wavelength [nm]") + ylab("Fraction of the excitation energy distributed to PSII")
Mole_abs %>%
transmute(
wavelength,
AlltoPSII = PSII / (1.5 * PSI + PSII)
) %>%
filter(AlltoPSII >= 0)  %>%
replace_na(list(AlltoPSII = 0)) %>%
ggplot(aes(x = wavelength, y = AlltoPSII)) +
theme_bw2() +
theme(panel.grid.major = element_blank()) +
geom_hline(yintercept = 0.5, col = "grey50", linetype = 3) +
gg_xy(c(380, 770, 0, 1.0)) +
# geom_ribbon(aes(ymin = AlltoPSII_max, ymax = AlltoPSII_min), col = "grey50") +
geom_line() +
stat_smooth(n = 5) +
xlab("Wavelength [nm]") + ylab("Fraction of the excitation energy distributed to PSII")
Mole_abs %>%
transmute(
wavelength,
AlltoPSII = PSII / (1.5 * PSI + PSII)
) %>%
filter(AlltoPSII >= 0)  %>%
replace_na(list(AlltoPSII = 0)) %>%
ggplot(aes(x = wavelength, y = AlltoPSII)) +
theme_bw2() +
theme(panel.grid.major = element_blank()) +
geom_hline(yintercept = 0.5, col = "grey50", linetype = 3) +
gg_xy(c(380, 770, 0, 1.0)) +
# geom_ribbon(aes(ymin = AlltoPSII_max, ymax = AlltoPSII_min), col = "grey50") +
geom_line() +
stat_smooth(n = 200) +
xlab("Wavelength [nm]") + ylab("Fraction of the excitation energy distributed to PSII")
Mole_abs %>%
transmute(
wavelength,
AlltoPSII = PSII / (1.5 * PSI + PSII)
) %>%
filter(AlltoPSII >= 0)  %>%
replace_na(list(AlltoPSII = 0)) %>%
ggplot(aes(x = wavelength, y = AlltoPSII)) +
theme_bw2() +
theme(panel.grid.major = element_blank()) +
geom_hline(yintercept = 0.5, col = "grey50", linetype = 3) +
gg_xy(c(380, 770, 0, 1.0)) +
# geom_ribbon(aes(ymin = AlltoPSII_max, ymax = AlltoPSII_min), col = "grey50") +
geom_line() +
stat_smooth(n = 1) +
xlab("Wavelength [nm]") + ylab("Fraction of the excitation energy distributed to PSII")
Mole_abs %>%
transmute(
wavelength,
AlltoPSII = PSII / (1.5 * PSI + PSII)
) %>%
filter(AlltoPSII >= 0)  %>%
replace_na(list(AlltoPSII = 0)) %>%
ggplot(aes(x = wavelength, y = AlltoPSII)) +
theme_bw2() +
theme(panel.grid.major = element_blank()) +
geom_hline(yintercept = 0.5, col = "grey50", linetype = 3) +
gg_xy(c(380, 770, 0, 1.0)) +
# geom_ribbon(aes(ymin = AlltoPSII_max, ymax = AlltoPSII_min), col = "grey50") +
geom_line() +
stat_smooth(span = 100) +
xlab("Wavelength [nm]") + ylab("Fraction of the excitation energy distributed to PSII")
Mole_abs %>%
transmute(
wavelength,
AlltoPSII = PSII / (1.5 * PSI + PSII)
) %>%
filter(AlltoPSII >= 0)  %>%
replace_na(list(AlltoPSII = 0)) %>%
ggplot(aes(x = wavelength, y = AlltoPSII)) +
theme_bw2() +
theme(panel.grid.major = element_blank()) +
geom_hline(yintercept = 0.5, col = "grey50", linetype = 3) +
gg_xy(c(380, 770, 0, 1.0)) +
# geom_ribbon(aes(ymin = AlltoPSII_max, ymax = AlltoPSII_min), col = "grey50") +
geom_line() +
stat_smooth(span = 3) +
xlab("Wavelength [nm]") + ylab("Fraction of the excitation energy distributed to PSII")
Mole_abs %>%
transmute(
wavelength,
AlltoPSII = PSII / (1.5 * PSI + PSII)
) %>%
filter(AlltoPSII >= 0)  %>%
replace_na(list(AlltoPSII = 0)) %>%
ggplot(aes(x = wavelength, y = AlltoPSII)) +
theme_bw2() +
theme(panel.grid.major = element_blank()) +
geom_hline(yintercept = 0.5, col = "grey50", linetype = 3) +
gg_xy(c(380, 770, 0, 1.0)) +
# geom_ribbon(aes(ymin = AlltoPSII_max, ymax = AlltoPSII_min), col = "grey50") +
geom_line() +
xlab("Wavelength [nm]") + ylab("Fraction of the excitation energy distributed to PSII")
Mole_abs %>%
transmute(
wavelength,
AlltoPSII = PSII / (1.5 * PSI + PSII)
) %>%
filter(AlltoPSII >= 0)  %>%
replace_na(list(AlltoPSII = 0)) %>%
ggplot(aes(x = wavelength, y = AlltoPSII)) +
theme_bw2() +
theme(panel.grid.major = element_blank()) +
geom_hline(yintercept = 0.5, col = "grey50", linetype = 3) +
gg_xy(c(380, 770, 0, 1.0)) +
# geom_ribbon(aes(ymin = AlltoPSII_max, ymax = AlltoPSII_min), col = "grey50") +
geom_line() +
stat_smooth(method = "gam") +
xlab("Wavelength [nm]") + ylab("Fraction of the excitation energy distributed to PSII")
ddd <-
fread("~/Dropbox/2016/1613/LI.csv") %>%
select(-HHMMSS) %>%
group_by(Trtm, PlantID, Light_Col, Light_Level) %>%
summarise_each(funs = "mean") %>%
select(Trtm:Light_Col, Photo, PARi)
library(lmerTest)
dmo <-
ddd %>%
mutate(ID = paste0(Trtm, PlantID)) %>%
select(-PlantID, col = Light_Col) %>%
lme4::lmer(data = ., formula = Photo ~ PARi + Trtm + col + (1|ID)) %>%
ranef
dmo %>% step
dmo %>% summary
str
AIC
summary
ddd %>%
do(lm(data = ., Photo ~ PARi) %>% tidy) %>%
select(Trtm:estimate) %>%
spread(term, estimate) %>%
group_by(Trtm, Light_Col) %>%
summarise_each(funs = "mean")
# select(Photo, PARi)
ggplot(aes(x = PARi, y = Photo, col = Light_Col, shape = factor(PlantID), group = paste(Light_Col, PlantID))) +
geom_smooth(method = "lm") +
geom_point() +
facet_grid(Trtm ~ .)
ddd %>%
do(lm(data = ., Photo ~ PARi) %>% tidy)
ddd %>%
do(lm(data = ., Photo ~ PARi) %>% tidy) %>%
select(Trtm:estimate)
ddd %>%
do(lm(data = ., Photo ~ PARi) %>% tidy)
ddd %>%
mutate(ID = paste0(Trtm, PlantID)) %>%
select(-PlantID, col = Light_Col) %>%
lme4::lmer(data = ., formula = Photo ~ PARi + Trtm + col + (1|ID)) %>%
ranef
ddd %>%
mutate(ID = paste0(Trtm, PlantID)) %>%
select(-PlantID, col = Light_Col)
Mole_abs
Mole_abs %>%
transmute(
wavelength,
AlltoPSII = PSII / (1.5 * PSI + PSII)
)
Mole_abs %>%
transmute(
wavelength,
AlltoPSII = PSII / (1.5 * PSI + PSII)
) %>%
.$AlltoPSII
Reduce(Join_by, list(Abs_PSII, Abs_PSI)) %>%
filter(wavelength %% 1 == 0) %>%
na.omit
Mole_abs <-
Reduce(Join_by, list(Abs_PSII, Abs_PSI)) %>%
filter(wavelength %% 1 == 0) %>%
na.omit
Mole_abs %>%
transmute(
wavelength,
AlltoPSII = PSII / (1.5 * PSI + PSII)
) %>%
.$AlltoPSII
Mole_abs
EED_dat <-
Mole_abs %>%
transmute(
wavelength,
AlltoPSII = PSII / (1.5 * PSI + PSII)
)
EED_dat$AlltoPSII
EED_dat %>%
mutate(c(NA, head(EED_dat$AlltoPSII, -1))
)
EED_dat %>%
mutate(All2 = c(NA, head(EED_dat$AlltoPSII, -1))
EED_dat %>%
mutate(All2 = c(NA, head(EED_dat$AlltoPSII, -1))) %>% head
EED_dat %>%
mutate(All2 = c(0, head(EED_dat$AlltoPSII, -1)),
AlltoPSII = (AlltoPSII + All2) / 2)
EED_dat %>%
mutate(All2_for = c(tail(EED_dat$AlltoPSII, -1), 0))
EED_dat %>%
mutate(All2_for = c(tail(EED_dat$AlltoPSII, -1), 0),
All2_back = c(0, head(EED_dat$AlltoPSII, -1))
) %>% head
EED_dat %>%
mutate(All2_for = c(tail(EED_dat$AlltoPSII, -1), 0),
All2_back = c(0, head(EED_dat$AlltoPSII, -1)),
AlltoPSII = (AlltoPSII + All2_for + All2_back) / 3)
EED_dat %>%
mutate(All2_for = c(tail(EED_dat$AlltoPSII, -1), 0),
All2_back = c(0, head(EED_dat$AlltoPSII, -1)),
AlltoPSII = (AlltoPSII + All2_for + All2_back) / 3) %>%
filter(AlltoPSII >= 0)  %>%
replace_na(list(AlltoPSII = 0)) %>%
ggplot(aes(x = wavelength, y = AlltoPSII)) +
theme_bw2() +
theme(panel.grid.major = element_blank()) +
geom_hline(yintercept = 0.5, col = "grey50", linetype = 3) +
gg_xy(c(380, 770, 0, 1.0)) +
# geom_ribbon(aes(ymin = AlltoPSII_max, ymax = AlltoPSII_min), col = "grey50") +
geom_line() +
xlab("Wavelength [nm]") + ylab("Fraction of the excitation energy distributed to PSII")
EED_dat %>%
mutate(All2_for = c(tail(EED_dat$AlltoPSII, -1), 0),
All2_back = c(0, head(EED_dat$AlltoPSII, -1)),
AlltoPSII = (AlltoPSII + All2_for + All2_back) / 3) %>%
filter(wavelength > 400)  %>%
replace_na(list(AlltoPSII = 0)) %>%
ggplot(aes(x = wavelength, y = AlltoPSII)) +
theme_bw2() +
theme(panel.grid.major = element_blank()) +
geom_hline(yintercept = 0.5, col = "grey50", linetype = 3) +
gg_xy(c(380, 770, 0, 1.0)) +
# geom_ribbon(aes(ymin = AlltoPSII_max, ymax = AlltoPSII_min), col = "grey50") +
geom_line() +
xlab("Wavelength [nm]") + ylab("Fraction of the excitation energy distributed to PSII")
